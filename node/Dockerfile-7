FROM registry.cn-hangzhou.aliyuncs.com/joinin/docker-phantomjs-alpine:latest

RUN apk update \
	&& apk upgrade \
	&& apk add --no-cache --virtual .build-deps \
	   curl g++ git build-base nodejs-dev gcc perl python ruby linux-headers make \
	&& rm /usr/local/bin/phantomjs /usr/bin/phantomjs \
	&& rm -rf /usr/share/fonts \
	&& mkdir -p /root \
	&& node -v \
	&& npm install -g gulp-cli cordova-hot-code-push-cli

RUN npm cache clear \
	&& apk del .build-deps \
	&& rm -rf /tmp/* /var/cache/apk/* /root/.gnupg /usr/lib/node_modules/npm/doc /usr/lib/node_modules/npm/html \
	&& npm config set registry https://registry.npm.taobao.org --global \
	&& echo "http://mirrors.aliyun.com/alpine/v3.5/main/" > /etc/apk/repositories \
	&& mkdir -p /root

COPY entrypoint.sh /sbin/entrypoint.sh

RUN chmod 755 /sbin/entrypoint.sh

EXPOSE 80

CMD ["/sbin/entrypoint.sh"]


